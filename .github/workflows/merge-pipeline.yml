name: Default Merge Pipeline

on:
  pull_request:
    types: [opened, synchronize, reopened] # Runs on opening a pr, pushing to a pr, and reopening a pr
    branches:
      - TSC-224-CI-CD-Pipeline

jobs:
  prettier:
    name: runner / prettier
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Install Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'
          
      - name: Install Dependencies
        run: yarn install

      - name: Manually Install Reviewdog
        run: |
          curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s
      
      - name: Run Prettier and Reviewdog
        env:
          REVIEWDOG_GITHUB_API_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          yarn prettier "**/*.{js,jsx,ts,tsx}" --check 2>&1 | sed --regexp-extended 's/(\[warn\].*)$/\1 File is not properly formatted./' | ./bin/reviewdog -f=diff -name="prettier" -reporter=github-pr-review -filter-mode=nofilter -fail-on-error=true -level=warning
  
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'

      - name: Install Dependencies
        run: yarn install

      - name: Prettify code
        uses: creyD/prettier_action@v4.3
        with:
          dry: True
          prettier_options: "--check **/*.{tsx,ts}"

      - name: Build with Vite
        run: yarn build

      - name: Run Tests
        run: echo Testing # Test command would go here
